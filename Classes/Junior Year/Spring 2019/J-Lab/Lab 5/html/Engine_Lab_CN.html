
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Engine_Lab_CN</title><meta name="generator" content="MATLAB 9.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-04-07"><meta name="DC.source" content="Engine_Lab_CN.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Reading in Data</a></li><li><a href="#3">Contants for the Engine</a></li><li><a href="#4">600 RPM</a></li><li><a href="#5">700 RPM</a></li><li><a href="#6">800 RPM</a></li><li><a href="#7">900 RPM</a></li><li><a href="#8">1000 RPM</a></li><li><a href="#9">1100 RPM</a></li><li><a href="#10">Final Calculations and Tables</a></li><li><a href="#11">Plotting End Results</a></li><li><a href="#12">Saving Figures</a></li></ul></div><pre class="codeinput"><span class="comment">% Engine Lab</span>
clear <span class="string">all</span>
close <span class="string">all</span>
</pre><h2 id="2">Reading in Data</h2><p>Reading in entire data set</p><pre class="codeinput">Header=22;
RPM600  = importdata(<span class="string">'600RPM.lvm'</span> ,<span class="string">'\t'</span>,Header);
RPM700  = importdata(<span class="string">'700RPM.lvm'</span> ,<span class="string">'\t'</span>,Header);
RPM800  = importdata(<span class="string">'800RPM.lvm'</span> ,<span class="string">'\t'</span>,Header);
RPM900  = importdata(<span class="string">'900RPM.lvm'</span> ,<span class="string">'\t'</span>,Header);
RPM1000 = importdata(<span class="string">'1000RPM.lvm'</span>,<span class="string">'\t'</span>,Header);
RPM1100 = importdata(<span class="string">'1100RPM.lvm'</span>,<span class="string">'\t'</span>,Header);

<span class="comment">% Separating entire data sets into vectors of Time and Voltage</span>
RPM600_Volt  = RPM600.data(:,2); <span class="comment">% Optical Sensor (V)</span>
RPM700_Volt  = RPM700.data(:,2);
RPM800_Volt  = RPM800.data(:,2);
RPM900_Volt  = RPM900.data(:,2);
RPM1000_Volt = RPM1000.data(:,2);
RPM1100_Volt = RPM1100.data(:,2);

RPM600_Pres  = RPM600.data(:,3); <span class="comment">% p(V)</span>
RPM700_Pres  = RPM700.data(:,3);
RPM800_Pres  = RPM800.data(:,3);
RPM900_Pres  = RPM900.data(:,3);
RPM1000_Pres = RPM1000.data(:,3);
RPM1100_Pres = RPM1100.data(:,3);
</pre><h2 id="3">Contants for the Engine</h2><pre class="codeinput">vp_conv  = 0.0104; <span class="comment">% V/psi</span>
CR       = 8.5; <span class="comment">% Compression Ratio</span>
Rod_L    = .116; <span class="comment">% Meters</span>
Stroke   = .067; <span class="comment">% Meters</span>
Vol_Disp = 624/(1e6); <span class="comment">% Cubic Meters</span>
Vol_Clea = Vol_Disp/(CR-1); <span class="comment">% Cubic Meters</span>
R        = 2*Rod_L/Stroke;
</pre><h2 id="4">600 RPM</h2><pre class="codeinput">Power_600 = 10.3*745.7; <span class="comment">% Watts</span>
dm_600 = (13640-13589)/1000; <span class="comment">% kilograms</span>

RPM600P = (RPM600_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM600t = zeros(1,length(RPM600P));

<span class="keyword">for</span> i = 1:length(RPM600t)
    RPM600t(i) = RPM600t(i) + (i-1)*.0004;
<span class="keyword">end</span>
RPM600t = RPM600t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM600_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM600_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_600(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM600_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_600 = zeros(length(RPM600_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_600)-1
    <span class="keyword">for</span> i = pos_600(j):pos_600(j+1)
        theta_600(i) = 2*pi*(1 - ((RPM600t(pos_600(j+1)) - RPM600t(i))/(RPM600t(pos_600(j+1)) - RPM600t(pos_600(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_600 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_600)-sqrt(R.^2-(sin(theta_600)).^2)));

<span class="comment">% Figure for Part 1a</span>

f1 = figure(1);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM600t(pos_600(1):pos_600(11)),RPM600P(pos_600(1):pos_600(11)))
ylabel(<span class="string">'Pressure (Pa)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM600t(pos_600(1):pos_600(11)),theta_600(pos_600(1):pos_600(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM600t(pos_600(1):pos_600(11)),Volume_600(pos_600(1):pos_600(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))
xlabel(<span class="string">'Time (Sec)'</span>)

<span class="comment">% Figure for part 1b</span>
f2=figure(2);
plot(Volume_600(pos_600(3):pos_600(5)),RPM600P(pos_600(3):pos_600(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>

f3=figure(3);
plot(Volume_600(pos_600(3):pos_600(end)),RPM600P(pos_600(3):pos_600(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_600(pos_600(i):pos_600(i+2)),RPM600P(pos_600(i):pos_600(i+2)))/2;
    P(j) = W(j)/(RPM600t(pos_600(i+2))-RPM600t(pos_600(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_600 = mean(W);
Avg_P_600 = mean(P);

MFR1 = dm_600/(60/RPM600t(end));
MFR = MFR1/(length(pos_600)/2);

MFR2_600 = dm_600/60;

MFR_Cyl_600 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_600 = Avg_P_600/1000; <span class="comment">% Power in KW</span>
Torque_600 = Avg_W_600/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_600 = 2*pi*(600/60)*Torque_600;
Brake_Eff_600 = Brake_Power_600/(MFR2_600*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_600  = Brake_Power_600/(Avg_P_600*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_01.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_02.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_03.png" alt=""> <h2 id="5">700 RPM</h2><pre class="codeinput">Power_700 = 12.8*745.7; <span class="comment">% Watts</span>
dm_700 = (13729-13666)/1000; <span class="comment">% kilograms</span>

RPM700P = (RPM700_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM700t = zeros(1,length(RPM700P));

<span class="keyword">for</span> i = 1:length(RPM700t)
    RPM700t(i) = RPM700t(i) + (i-1)*.0002;
<span class="keyword">end</span>
RPM700t = RPM700t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM700_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM700_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_700(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM700_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_700 = zeros(length(RPM700_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_700)-1
    <span class="keyword">for</span> i = pos_700(j):pos_700(j+1)
        theta_700(i) = 2*pi*(1 - ((RPM700t(pos_700(j+1)) - RPM700t(i))/(RPM700t(pos_700(j+1)) - RPM700t(pos_700(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_700 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_700)-sqrt(R.^2-(sin(theta_700)).^2)));

<span class="comment">% Figure for Part 1a</span>

f4=figure(4);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM700t(pos_700(1):pos_700(11)),RPM700P(pos_700(1):pos_700(11)))
ylabel(<span class="string">'Pressure (Pa)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM700t(pos_700(1):pos_700(11)),theta_700(pos_700(1):pos_700(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM700t(pos_700(1):pos_700(11)),Volume_700(pos_700(1):pos_700(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))
xlabel(<span class="string">'Time (Sec)'</span>)

<span class="comment">% Figure for part 1b</span>
f18=figure(18);
plot(Volume_700(pos_700(3):pos_700(5)),RPM700P(pos_700(3):pos_700(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>

f5=figure(5);
plot(Volume_700(pos_700(3):pos_700(end)),RPM700P(pos_700(3):pos_700(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_700(pos_700(i):pos_700(i+2)),RPM700P(pos_700(i):pos_700(i+2)))/2;
    P(j) = W(j)/(RPM700t(pos_700(i+2))-RPM700t(pos_700(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_700 = mean(W);
Avg_P_700 = mean(P);

MFR = (dm_700/(60/RPM700t(end)))/(length(pos_700)/2);

<span class="comment">%MFR = ((dm_700/(60/RPM700t(end)))/(length(pos_700)/2));</span>
MFR2_700 = dm_700/60;

MFR_Cyl_700 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_700 = Avg_P_700/1000; <span class="comment">% Power in KW</span>
Torque_700 = Avg_W_700/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_700 = 2*pi*(700/60)*Torque_700;
Brake_Eff_700 = Brake_Power_700/(MFR2_700*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_700  = Brake_Power_700/(Avg_P_700*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_04.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_05.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_06.png" alt=""> <h2 id="6">800 RPM</h2><pre class="codeinput">Power_800 = 14.9*745.7; <span class="comment">% Watts</span>
dm_800 = (13829-13760)/1000; <span class="comment">% kilograms</span>

RPM800P = (RPM800_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM800t = zeros(1,length(RPM800P));

<span class="keyword">for</span> i = 1:length(RPM800t)
    RPM800t(i) = RPM800t(i) + (i-1)*.0002;
<span class="keyword">end</span>
RPM800t = RPM800t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM800_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM800_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_800(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM800_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_800 = zeros(length(RPM800_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_800)-1
    <span class="keyword">for</span> i = pos_800(j):pos_800(j+1)
        theta_800(i) = 2*pi*(1 - ((RPM800t(pos_800(j+1)) - RPM800t(i))/(RPM800t(pos_800(j+1)) - RPM800t(pos_800(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_800 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_800)-sqrt(R.^2-(sin(theta_800)).^2)));

<span class="comment">% Figure for Part 1a</span>

f6=figure(6);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM800t(pos_800(1):pos_800(11)),RPM800P(pos_800(1):pos_800(11)))
ylabel(<span class="string">'Pressure (Pa)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM800t(pos_800(1):pos_800(11)),theta_800(pos_800(1):pos_800(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM800t(pos_800(1):pos_800(11)),Volume_800(pos_800(1):pos_800(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))
xlabel(<span class="string">'Time (Sec)'</span>)

<span class="comment">% Figure for part 1b</span>
f19=figure(19);
plot(Volume_800(pos_800(3):pos_800(5)),RPM800P(pos_800(3):pos_800(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>
f7=figure(7);
plot(Volume_800(pos_800(3):pos_800(end)),RPM800P(pos_800(3):pos_800(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_800(pos_800(i):pos_800(i+2)),RPM800P(pos_800(i):pos_800(i+2)))/2;
    P(j) = W(j)/(RPM800t(pos_800(i+2))-RPM800t(pos_800(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_800 = mean(W);
Avg_P_800 = mean(P);

MFR = (dm_800/(60/RPM800t(end)))/(length(pos_800)/2);

<span class="comment">%MFR = ((dm_800/(60/RPM800t(end)))/(length(pos_800)/2));</span>
MFR2_800 = dm_800/60;

MFR_Cyl_800 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_800 = Avg_P_800/1000; <span class="comment">% Power in KW</span>
Torque_800 = Avg_W_800/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_800 = 2*pi*(800/60)*Torque_800;
Brake_Eff_800 = Brake_Power_800/(MFR2_800*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_800  = Brake_Power_800/(Avg_P_800*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_07.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_08.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_09.png" alt=""> <h2 id="7">900 RPM</h2><pre class="codeinput">Power_900 = 16.6*745.7; <span class="comment">% Watts</span>
dm_900 = (13941-13864)/1000; <span class="comment">% kilograms</span>

RPM900P = (RPM900_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM900t = zeros(1,length(RPM900P));

<span class="keyword">for</span> i = 1:length(RPM900t)
    RPM900t(i) = RPM900t(i) + (i-1)*.0002;
<span class="keyword">end</span>
RPM900t = RPM900t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM900_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM900_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_900(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM900_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_900 = zeros(length(RPM900_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_900)-1
    <span class="keyword">for</span> i = pos_900(j):pos_900(j+1)
        theta_900(i) = 2*pi*(1 - ((RPM900t(pos_900(j+1)) - RPM900t(i))/(RPM900t(pos_900(j+1)) - RPM900t(pos_900(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_900 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_900)-sqrt(R.^2-(sin(theta_900)).^2)));

<span class="comment">% Figure for Part 1a</span>
f8=figure(8);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM900t(pos_900(1):pos_900(11)),RPM900P(pos_900(1):pos_900(11)))
ylabel(<span class="string">'Pressure (V)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM900t(pos_900(1):pos_900(11)),theta_900(pos_900(1):pos_900(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM900t(pos_900(1):pos_900(11)),Volume_900(pos_900(1):pos_900(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))
xlabel(<span class="string">'Time (Sec)'</span>)


<span class="comment">% Figure for part 1b</span>
f20=figure(20);
plot(Volume_900(pos_900(3):pos_900(5)),RPM900P(pos_900(3):pos_900(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>
f9=figure(9);
plot(Volume_900(pos_900(3):pos_900(end)),RPM900P(pos_900(3):pos_900(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_900(pos_900(i):pos_900(i+2)),RPM900P(pos_900(i):pos_900(i+2)))/2;
    P(j) = W(j)/(RPM900t(pos_900(i+2))-RPM900t(pos_900(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_900 = mean(W);
Avg_P_900 = mean(P);

MFR = (dm_900/(60/RPM900t(end)))/(length(pos_900)/2);

<span class="comment">%MFR = ((dm_900/(60/RPM900t(end)))/(length(pos_900)/2));</span>
MFR2_900 = dm_900/60;

MFR_Cyl_900 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_900 = Avg_P_900/1000 ;<span class="comment">% Power in KW</span>
Torque_900 = Avg_W_900/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_900 = 2*pi*(900/60)*Torque_900;
Brake_Eff_900 = Brake_Power_900/(MFR2_900*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_900  = Brake_Power_900/(Avg_P_900*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_10.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_11.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_12.png" alt=""> <h2 id="8">1000 RPM</h2><pre class="codeinput">Power_1000 = 17.7*745.7; <span class="comment">% Watts</span>
dm_1000 = (14056-13976)/1000; <span class="comment">% kilograms</span>

RPM1000P = (RPM1000_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM1000t = zeros(1,length(RPM1000P));

<span class="keyword">for</span> i = 1:length(RPM1000t)
    RPM1000t(i) = RPM1000t(i) + (i-1)*.0002;
<span class="keyword">end</span>
RPM1000t = RPM1000t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM1000_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM1000_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_1000(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM1000_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_1000 = zeros(length(RPM1000_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_1000)-1
    <span class="keyword">for</span> i = pos_1000(j):pos_1000(j+1)
        theta_1000(i) = 2*pi*(1 - ((RPM1000t(pos_1000(j+1)) - RPM1000t(i))/(RPM1000t(pos_1000(j+1)) - RPM1000t(pos_1000(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_1000 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_1000)-sqrt(R.^2-(sin(theta_1000)).^2)));

<span class="comment">% Figure for Part 1a</span>
f10=figure(10);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000P(pos_1000(1):pos_1000(11)))
ylabel(<span class="string">'Pressure (Pa)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1000t(pos_1000(1):pos_1000(11)),theta_1000(pos_1000(1):pos_1000(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1000t(pos_1000(1):pos_1000(11)),Volume_1000(pos_1000(1):pos_1000(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))
xlabel(<span class="string">'Time (Sec)'</span>)

<span class="comment">% Figure for part 1b</span>
f21=figure(21);
plot(Volume_1000(pos_1000(3):pos_1000(5)),RPM1000P(pos_1000(3):pos_1000(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>
f11=figure(11);
plot(Volume_1000(pos_1000(3):pos_1000(end)),RPM1000P(pos_1000(3):pos_1000(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_1000(pos_1000(i):pos_1000(i+2)),RPM1000P(pos_1000(i):pos_1000(i+2)))/2;
    P(j) = W(j)/(RPM1000t(pos_1000(i+2))-RPM1000t(pos_1000(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_1000 = mean(W);
Avg_P_1000 = mean(P);

MFR = (dm_1000/(60/RPM1000t(end)))/(length(pos_1000)/2);

<span class="comment">%MFR = ((dm_1000/(60/RPM1000t(end)))/(length(pos_1000)/2));</span>
MFR2_1000 = dm_1000/60;

MFR_Cyl_1000 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_1000 = Avg_P_1000/1000; <span class="comment">% Power in KW</span>
Torque_1000 = Avg_W_1000/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_1000 = 2*pi*(1000/60)*Torque_1000;
Brake_Eff_1000 = Brake_Power_1000/(MFR2_1000*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_1000  = Brake_Power_1000/(Avg_P_1000*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_13.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_14.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_15.png" alt=""> <h2 id="9">1100 RPM</h2><pre class="codeinput">Power_1100 = 12*745.7; <span class="comment">% Watts</span>
dm_1100 = (14156-14097)/1000; <span class="comment">% kilograms</span>

RPM1100P = (RPM1100_Pres./vp_conv).*6894; <span class="comment">% Pa</span>
RPM1100t = zeros(1,length(RPM1100P));

<span class="keyword">for</span> i = 1:length(RPM1100t)
    RPM1100t(i) = RPM1100t(i) + (i-1)*.0002;
<span class="keyword">end</span>
RPM1100t = RPM1100t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM1100_Volt);

<span class="keyword">for</span> i = 1:n
    <span class="keyword">if</span> RPM1100_Volt(i) - thresh &gt; 0 &amp;&amp; sw == 0
        sw = 1;
        pos_1100(j) = i;
        j = j + 1;
    <span class="keyword">elseif</span> RPM1100_Volt(i) - thresh &lt; 0 &amp;&amp; sw == 1
        sw = 0;
    <span class="keyword">end</span>
<span class="keyword">end</span>

theta_1100 = zeros(length(RPM1100_Volt)-5,1);
<span class="keyword">for</span> j = 1:length(pos_1100)-1
    <span class="keyword">for</span> i = pos_1100(j):pos_1100(j+1)
        theta_1100(i) = 2*pi*(1 - ((RPM1100t(pos_1100(j+1)) - RPM1100t(i))/(RPM1100t(pos_1100(j+1)) - RPM1100t(pos_1100(j)))));
    <span class="keyword">end</span>
<span class="keyword">end</span>

Volume_1100 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_1100)-sqrt(R.^2-(sin(theta_1100)).^2)));

<span class="comment">% Figure for Part 1a</span>
f12=figure(12);
subplot(3,1,3)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100P(pos_1100(1):pos_1100(11)))
ylabel(<span class="string">'Pressure (Pa)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))

subplot(3,1,1)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1100t(pos_1100(1):pos_1100(11)),theta_1100(pos_1100(1):pos_1100(11)))
ylabel(<span class="string">'Angle (Radians)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))

subplot(3,1,2)
hold <span class="string">on</span>
yyaxis <span class="string">left</span>
plot(RPM1100t(pos_1100(1):pos_1100(11)),Volume_1100(pos_1100(1):pos_1100(11)))
ylabel(<span class="string">'Volume (m^3)'</span>)
yyaxis <span class="string">right</span>
ylabel(<span class="string">'Output Voltage (V)'</span>)
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))
xlabel(<span class="string">'Time (Sec)'</span>)

<span class="comment">% Figure for part 1b</span>
f22=figure(22);
plot(Volume_1100(pos_1100(3):pos_1100(5)),RPM1100P(pos_1100(3):pos_1100(5)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)

<span class="comment">% Figure for part 1c</span>
f13=figure(13);
plot(Volume_1100(pos_1100(3):pos_1100(end)),RPM1100P(pos_1100(3):pos_1100(end)))
xlabel(<span class="string">'Cylinder Volume (m^3)'</span>)
ylabel(<span class="string">'Cylinder Pressure (Pa)'</span>)



<span class="comment">% Part 2</span>
j=1;
W = zeros(10,1);
P = zeros(10,1);
<span class="keyword">for</span> i = 1:2:19
    W(j) = trapz(Volume_1100(pos_1100(i):pos_1100(i+2)),RPM1100P(pos_1100(i):pos_1100(i+2)))/2;
    P(j) = W(j)/(RPM1100t(pos_1100(i+2))-RPM1100t(pos_1100(i)));
    j=j+1;
<span class="keyword">end</span>

Avg_W_1100 = mean(W);
Avg_P_1100 = mean(P);

MFR = (dm_1100/(60/RPM1100t(end)))/(length(pos_1100)/2);

<span class="comment">%MFR = ((dm_1100/(60/RPM1100t(end)))/(length(pos_1100)/2));</span>
MFR2_1100 = dm_1100/60;

MFR_Cyl_1100 = MFR/2; <span class="comment">% Flow rate of one cylinder per cycle</span>
KW_1100 = Avg_P_1100/1000; <span class="comment">% Power in KW</span>
Torque_1100 = Avg_W_1100/3.16; <span class="comment">% Engine Torque</span>
Brake_Power_1100 = 2*pi*(1100/60)*Torque_1100;
Brake_Eff_1100 = Brake_Power_1100/(MFR2_600*(44e6)); <span class="comment">% Brake thermal eff</span>
Conv_Eff_1100  = Brake_Power_1100/(Avg_P_1100*2); <span class="comment">% Mechanical conversion eff</span>
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_16.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_17.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_18.png" alt=""> <h2 id="10">Final Calculations and Tables</h2><pre class="codeinput">Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100];
Power = [Avg_P_600;Avg_P_700;Avg_P_800;Avg_P_900;Avg_P_1000;Avg_P_1100];
Std_Work = std(Work);
Std_Power = std(Power);

RPM = [<span class="string">"600"</span>;<span class="string">"700"</span>;<span class="string">"800"</span>;<span class="string">"900"</span>;<span class="string">"1000"</span>;<span class="string">"1100"</span>;<span class="string">"Standard Deviation"</span>]; <span class="comment">% rotations per minute</span>
Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100;Std_Work];
Power = [Avg_P_600;Avg_P_700;Avg_P_800;Avg_P_900;Avg_P_1000;Avg_P_1100;Std_Power];

T1 = table(RPM,Work,Power);


RPM = [<span class="string">"600"</span>;<span class="string">"700"</span>;<span class="string">"800"</span>;<span class="string">"900"</span>;<span class="string">"1000"</span>;<span class="string">"1100"</span>]; <span class="comment">% rotations per minute</span>
MFR = [MFR_Cyl_600;MFR_Cyl_700;MFR_Cyl_800;MFR_Cyl_900;MFR_Cyl_1000;MFR_Cyl_1100]; <span class="comment">% Mass flow rate kg/s</span>
Power = [KW_600;KW_700;KW_800;KW_900;KW_1000;KW_1100]; <span class="comment">% power in KW</span>
Torque = [Torque_600;Torque_700;Torque_800;Torque_900;Torque_1000;Torque_1100]; <span class="comment">% N-m</span>
Brake_Efficiency = [Brake_Eff_600;Brake_Eff_700;Brake_Eff_800;Brake_Eff_900;Brake_Eff_1000;Brake_Eff_1100];
Conversion_Efficieny = [Conv_Eff_600;Conv_Eff_700;Conv_Eff_800;Conv_Eff_900;Conv_Eff_1000;Conv_Eff_1100];

T2 = table(RPM,MFR,Power,Torque,Brake_Efficiency,Conversion_Efficieny);
</pre><h2 id="11">Plotting End Results</h2><pre class="codeinput">Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100];
RPM = [600;700;800;900;1000;1100]; <span class="comment">% rotations per minute</span>
BrakeTorque = 2*pi.*Work;

Torque = [Torque_600,Torque_700,Torque_800,Torque_900,Torque_1000,Torque_1100];

<span class="keyword">for</span> i = 1:length(Torque)
    BrakePower(i) = 2*pi.*(RPM(i)/60).*Torque(i);
<span class="keyword">end</span>

f14=figure(14);
yyaxis <span class="string">left</span>
plot(RPM,BrakeTorque,<span class="string">'-o'</span>)
ylabel(<span class="string">'Brake Torque (J)'</span>)
hold <span class="string">on</span>
yyaxis <span class="string">right</span>
plot(RPM,BrakePower,<span class="string">'-s'</span>)
ylabel(<span class="string">'Brake Power (J/s)'</span>)
xlabel(<span class="string">'Rotations Per Minute'</span>)
text(650,11000,<span class="string">'Maximum Brake Torque = 2113 J'</span>)
text(650,10500,<span class="string">'Maximum Brake Power = 11,150 J/s'</span>)

f15=figure(15);
plot(RPM,Brake_Efficiency,<span class="string">'-o'</span>)
xlabel(<span class="string">'Rotations Per Minute'</span>)
ylabel(<span class="string">'Brake Efficiency ( )'</span>)

f16 = figure(16);
plot(RPM,MFR,<span class="string">'-o'</span>)
xlabel(<span class="string">'Rotations Per Minute'</span>)
ylabel(<span class="string">'Mass Flow Rate (kg/Cycle/Cylinder)'</span>)

MFR2 = [MFR2_600,MFR2_700,MFR2_800,MFR2_900,MFR2_1000,MFR2_1100];
f17 = figure(17);
plot(RPM,MFR2,<span class="string">'-o'</span>)
xlabel(<span class="string">'Rotations Per Minute'</span>)
ylabel(<span class="string">'Mass Flow Rate (kg/s)'</span>)
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_19.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_20.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_21.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_22.png" alt=""> <h2 id="12">Saving Figures</h2><pre class="codeinput">saveas(f1, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot600.png'</span>,<span class="string">'png'</span>);
saveas(f2, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle600.png'</span>,<span class="string">'png'</span>);
saveas(f3, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle600.png'</span>,<span class="string">'png'</span>);

saveas(f4, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot700.png'</span>,<span class="string">'png'</span>);
saveas(f5, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle700.png'</span>,<span class="string">'png'</span>);

saveas(f6, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot800.png'</span>,<span class="string">'png'</span>);
saveas(f7, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle800.png'</span>,<span class="string">'png'</span>);

saveas(f8, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot900.png'</span>,<span class="string">'png'</span>);
saveas(f9, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle900.png'</span>,<span class="string">'png'</span>);

saveas(f10, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot1000.png'</span>,<span class="string">'png'</span>);
saveas(f11, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle1000.png'</span>,<span class="string">'png'</span>);

saveas(f12, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot1100.png'</span>,<span class="string">'png'</span>);
saveas(f13, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle1100.png'</span>,<span class="string">'png'</span>);

saveas(f14, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\braketorquepower.png'</span>,<span class="string">'png'</span>);
saveas(f15, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\thermaleff.png'</span>,<span class="string">'png'</span>);

saveas(f16, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\mfr.png'</span>,<span class="string">'png'</span>);
saveas(f17, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\mfgkgs.png'</span>,<span class="string">'png'</span>);

saveas(f18, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle700.png'</span>,<span class="string">'png'</span>);
saveas(f19, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle800.png'</span>,<span class="string">'png'</span>);
saveas(f20, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle900.png'</span>,<span class="string">'png'</span>);
saveas(f21, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle1000.png'</span>,<span class="string">'png'</span>);
saveas(f22, <span class="string">'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle1100.png'</span>,<span class="string">'png'</span>);
</pre><img vspace="5" hspace="5" src="Engine_Lab_CN_23.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_24.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_25.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_26.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_27.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_28.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_29.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_30.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_31.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_32.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_33.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_34.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_35.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_36.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_37.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_38.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_39.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_40.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_41.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_42.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_43.png" alt=""> <img vspace="5" hspace="5" src="Engine_Lab_CN_44.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018a</a><br></p></div><!--
##### SOURCE BEGIN #####
% Engine Lab
clear all
close all

%% Reading in Data
% Reading in entire data set
Header=22;
RPM600  = importdata('600RPM.lvm' ,'\t',Header);
RPM700  = importdata('700RPM.lvm' ,'\t',Header);
RPM800  = importdata('800RPM.lvm' ,'\t',Header);
RPM900  = importdata('900RPM.lvm' ,'\t',Header);
RPM1000 = importdata('1000RPM.lvm','\t',Header);
RPM1100 = importdata('1100RPM.lvm','\t',Header);

% Separating entire data sets into vectors of Time and Voltage
RPM600_Volt  = RPM600.data(:,2); % Optical Sensor (V)
RPM700_Volt  = RPM700.data(:,2);
RPM800_Volt  = RPM800.data(:,2);
RPM900_Volt  = RPM900.data(:,2);
RPM1000_Volt = RPM1000.data(:,2);
RPM1100_Volt = RPM1100.data(:,2); 

RPM600_Pres  = RPM600.data(:,3); % p(V)
RPM700_Pres  = RPM700.data(:,3);
RPM800_Pres  = RPM800.data(:,3);
RPM900_Pres  = RPM900.data(:,3);
RPM1000_Pres = RPM1000.data(:,3);
RPM1100_Pres = RPM1100.data(:,3);


%% Contants for the Engine

vp_conv  = 0.0104; % V/psi
CR       = 8.5; % Compression Ratio
Rod_L    = .116; % Meters
Stroke   = .067; % Meters
Vol_Disp = 624/(1e6); % Cubic Meters
Vol_Clea = Vol_Disp/(CR-1); % Cubic Meters
R        = 2*Rod_L/Stroke; 

%% 600 RPM

Power_600 = 10.3*745.7; % Watts
dm_600 = (13640-13589)/1000; % kilograms

RPM600P = (RPM600_Pres./vp_conv).*6894; % Pa
RPM600t = zeros(1,length(RPM600P));

for i = 1:length(RPM600t)
    RPM600t(i) = RPM600t(i) + (i-1)*.0004;
end
RPM600t = RPM600t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM600_Volt);

for i = 1:n
    if RPM600_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_600(j) = i;
        j = j + 1;
    elseif RPM600_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_600 = zeros(length(RPM600_Volt)-5,1);
for j = 1:length(pos_600)-1
    for i = pos_600(j):pos_600(j+1)
        theta_600(i) = 2*pi*(1 - ((RPM600t(pos_600(j+1)) - RPM600t(i))/(RPM600t(pos_600(j+1)) - RPM600t(pos_600(j)))));
    end
end

Volume_600 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_600)-sqrt(R.^2-(sin(theta_600)).^2)));

% Figure for Part 1a

f1 = figure(1);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM600t(pos_600(1):pos_600(11)),RPM600P(pos_600(1):pos_600(11)))
ylabel('Pressure (Pa)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM600t(pos_600(1):pos_600(11)),theta_600(pos_600(1):pos_600(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM600t(pos_600(1):pos_600(11)),Volume_600(pos_600(1):pos_600(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM600t(pos_600(1):pos_600(11)),RPM600_Volt(pos_600(1):pos_600(11)))
xlabel('Time (Sec)')

% Figure for part 1b
f2=figure(2);
plot(Volume_600(pos_600(3):pos_600(5)),RPM600P(pos_600(3):pos_600(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c

f3=figure(3);
plot(Volume_600(pos_600(3):pos_600(end)),RPM600P(pos_600(3):pos_600(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_600(pos_600(i):pos_600(i+2)),RPM600P(pos_600(i):pos_600(i+2)))/2;
    P(j) = W(j)/(RPM600t(pos_600(i+2))-RPM600t(pos_600(i)));
    j=j+1;
end

Avg_W_600 = mean(W);
Avg_P_600 = mean(P);

MFR1 = dm_600/(60/RPM600t(end));
MFR = MFR1/(length(pos_600)/2);

MFR2_600 = dm_600/60;

MFR_Cyl_600 = MFR/2; % Flow rate of one cylinder per cycle
KW_600 = Avg_P_600/1000; % Power in KW
Torque_600 = Avg_W_600/3.16; % Engine Torque
Brake_Power_600 = 2*pi*(600/60)*Torque_600;  
Brake_Eff_600 = Brake_Power_600/(MFR2_600*(44e6)); % Brake thermal eff
Conv_Eff_600  = Brake_Power_600/(Avg_P_600*2); % Mechanical conversion eff



%% 700 RPM

Power_700 = 12.8*745.7; % Watts
dm_700 = (13729-13666)/1000; % kilograms

RPM700P = (RPM700_Pres./vp_conv).*6894; % Pa
RPM700t = zeros(1,length(RPM700P));

for i = 1:length(RPM700t)
    RPM700t(i) = RPM700t(i) + (i-1)*.0002;
end
RPM700t = RPM700t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM700_Volt);

for i = 1:n
    if RPM700_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_700(j) = i;
        j = j + 1;
    elseif RPM700_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_700 = zeros(length(RPM700_Volt)-5,1);
for j = 1:length(pos_700)-1
    for i = pos_700(j):pos_700(j+1)
        theta_700(i) = 2*pi*(1 - ((RPM700t(pos_700(j+1)) - RPM700t(i))/(RPM700t(pos_700(j+1)) - RPM700t(pos_700(j)))));
    end
end

Volume_700 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_700)-sqrt(R.^2-(sin(theta_700)).^2)));

% Figure for Part 1a

f4=figure(4);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM700t(pos_700(1):pos_700(11)),RPM700P(pos_700(1):pos_700(11)))
ylabel('Pressure (Pa)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM700t(pos_700(1):pos_700(11)),theta_700(pos_700(1):pos_700(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM700t(pos_700(1):pos_700(11)),Volume_700(pos_700(1):pos_700(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM700t(pos_700(1):pos_700(11)),RPM700_Volt(pos_700(1):pos_700(11)))
xlabel('Time (Sec)')

% Figure for part 1b
f18=figure(18);
plot(Volume_700(pos_700(3):pos_700(5)),RPM700P(pos_700(3):pos_700(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c

f5=figure(5);
plot(Volume_700(pos_700(3):pos_700(end)),RPM700P(pos_700(3):pos_700(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_700(pos_700(i):pos_700(i+2)),RPM700P(pos_700(i):pos_700(i+2)))/2;
    P(j) = W(j)/(RPM700t(pos_700(i+2))-RPM700t(pos_700(i)));
    j=j+1;
end

Avg_W_700 = mean(W);
Avg_P_700 = mean(P);

MFR = (dm_700/(60/RPM700t(end)))/(length(pos_700)/2);

%MFR = ((dm_700/(60/RPM700t(end)))/(length(pos_700)/2));
MFR2_700 = dm_700/60;

MFR_Cyl_700 = MFR/2; % Flow rate of one cylinder per cycle
KW_700 = Avg_P_700/1000; % Power in KW
Torque_700 = Avg_W_700/3.16; % Engine Torque
Brake_Power_700 = 2*pi*(700/60)*Torque_700;  
Brake_Eff_700 = Brake_Power_700/(MFR2_700*(44e6)); % Brake thermal eff
Conv_Eff_700  = Brake_Power_700/(Avg_P_700*2); % Mechanical conversion eff


%% 800 RPM

Power_800 = 14.9*745.7; % Watts
dm_800 = (13829-13760)/1000; % kilograms

RPM800P = (RPM800_Pres./vp_conv).*6894; % Pa
RPM800t = zeros(1,length(RPM800P));

for i = 1:length(RPM800t)
    RPM800t(i) = RPM800t(i) + (i-1)*.0002;
end
RPM800t = RPM800t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM800_Volt);

for i = 1:n
    if RPM800_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_800(j) = i;
        j = j + 1;
    elseif RPM800_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_800 = zeros(length(RPM800_Volt)-5,1);
for j = 1:length(pos_800)-1
    for i = pos_800(j):pos_800(j+1)
        theta_800(i) = 2*pi*(1 - ((RPM800t(pos_800(j+1)) - RPM800t(i))/(RPM800t(pos_800(j+1)) - RPM800t(pos_800(j)))));
    end
end

Volume_800 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_800)-sqrt(R.^2-(sin(theta_800)).^2)));

% Figure for Part 1a

f6=figure(6);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM800t(pos_800(1):pos_800(11)),RPM800P(pos_800(1):pos_800(11)))
ylabel('Pressure (Pa)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM800t(pos_800(1):pos_800(11)),theta_800(pos_800(1):pos_800(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM800t(pos_800(1):pos_800(11)),Volume_800(pos_800(1):pos_800(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM800t(pos_800(1):pos_800(11)),RPM800_Volt(pos_800(1):pos_800(11)))
xlabel('Time (Sec)')

% Figure for part 1b
f19=figure(19);
plot(Volume_800(pos_800(3):pos_800(5)),RPM800P(pos_800(3):pos_800(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c
f7=figure(7);
plot(Volume_800(pos_800(3):pos_800(end)),RPM800P(pos_800(3):pos_800(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_800(pos_800(i):pos_800(i+2)),RPM800P(pos_800(i):pos_800(i+2)))/2;
    P(j) = W(j)/(RPM800t(pos_800(i+2))-RPM800t(pos_800(i)));
    j=j+1;
end

Avg_W_800 = mean(W);
Avg_P_800 = mean(P);

MFR = (dm_800/(60/RPM800t(end)))/(length(pos_800)/2);

%MFR = ((dm_800/(60/RPM800t(end)))/(length(pos_800)/2));
MFR2_800 = dm_800/60;

MFR_Cyl_800 = MFR/2; % Flow rate of one cylinder per cycle
KW_800 = Avg_P_800/1000; % Power in KW
Torque_800 = Avg_W_800/3.16; % Engine Torque
Brake_Power_800 = 2*pi*(800/60)*Torque_800;  
Brake_Eff_800 = Brake_Power_800/(MFR2_800*(44e6)); % Brake thermal eff
Conv_Eff_800  = Brake_Power_800/(Avg_P_800*2); % Mechanical conversion eff

%% 900 RPM

Power_900 = 16.6*745.7; % Watts
dm_900 = (13941-13864)/1000; % kilograms

RPM900P = (RPM900_Pres./vp_conv).*6894; % Pa
RPM900t = zeros(1,length(RPM900P));

for i = 1:length(RPM900t)
    RPM900t(i) = RPM900t(i) + (i-1)*.0002;
end
RPM900t = RPM900t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM900_Volt);

for i = 1:n
    if RPM900_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_900(j) = i;
        j = j + 1;
    elseif RPM900_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_900 = zeros(length(RPM900_Volt)-5,1);
for j = 1:length(pos_900)-1
    for i = pos_900(j):pos_900(j+1)
        theta_900(i) = 2*pi*(1 - ((RPM900t(pos_900(j+1)) - RPM900t(i))/(RPM900t(pos_900(j+1)) - RPM900t(pos_900(j)))));
    end
end

Volume_900 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_900)-sqrt(R.^2-(sin(theta_900)).^2)));

% Figure for Part 1a
f8=figure(8);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM900t(pos_900(1):pos_900(11)),RPM900P(pos_900(1):pos_900(11)))
ylabel('Pressure (V)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM900t(pos_900(1):pos_900(11)),theta_900(pos_900(1):pos_900(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM900t(pos_900(1):pos_900(11)),Volume_900(pos_900(1):pos_900(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM900t(pos_900(1):pos_900(11)),RPM900_Volt(pos_900(1):pos_900(11)))
xlabel('Time (Sec)')


% Figure for part 1b
f20=figure(20);
plot(Volume_900(pos_900(3):pos_900(5)),RPM900P(pos_900(3):pos_900(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c
f9=figure(9);
plot(Volume_900(pos_900(3):pos_900(end)),RPM900P(pos_900(3):pos_900(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_900(pos_900(i):pos_900(i+2)),RPM900P(pos_900(i):pos_900(i+2)))/2;
    P(j) = W(j)/(RPM900t(pos_900(i+2))-RPM900t(pos_900(i)));
    j=j+1;
end

Avg_W_900 = mean(W);
Avg_P_900 = mean(P);

MFR = (dm_900/(60/RPM900t(end)))/(length(pos_900)/2);

%MFR = ((dm_900/(60/RPM900t(end)))/(length(pos_900)/2));
MFR2_900 = dm_900/60;

MFR_Cyl_900 = MFR/2; % Flow rate of one cylinder per cycle
KW_900 = Avg_P_900/1000 ;% Power in KW
Torque_900 = Avg_W_900/3.16; % Engine Torque
Brake_Power_900 = 2*pi*(900/60)*Torque_900;  
Brake_Eff_900 = Brake_Power_900/(MFR2_900*(44e6)); % Brake thermal eff
Conv_Eff_900  = Brake_Power_900/(Avg_P_900*2); % Mechanical conversion eff

%% 1000 RPM

Power_1000 = 17.7*745.7; % Watts
dm_1000 = (14056-13976)/1000; % kilograms

RPM1000P = (RPM1000_Pres./vp_conv).*6894; % Pa
RPM1000t = zeros(1,length(RPM1000P));

for i = 1:length(RPM1000t)
    RPM1000t(i) = RPM1000t(i) + (i-1)*.0002;
end
RPM1000t = RPM1000t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM1000_Volt);

for i = 1:n
    if RPM1000_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_1000(j) = i;
        j = j + 1;
    elseif RPM1000_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_1000 = zeros(length(RPM1000_Volt)-5,1);
for j = 1:length(pos_1000)-1
    for i = pos_1000(j):pos_1000(j+1)
        theta_1000(i) = 2*pi*(1 - ((RPM1000t(pos_1000(j+1)) - RPM1000t(i))/(RPM1000t(pos_1000(j+1)) - RPM1000t(pos_1000(j)))));
    end
end

Volume_1000 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_1000)-sqrt(R.^2-(sin(theta_1000)).^2)));

% Figure for Part 1a
f10=figure(10);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000P(pos_1000(1):pos_1000(11)))
ylabel('Pressure (Pa)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM1000t(pos_1000(1):pos_1000(11)),theta_1000(pos_1000(1):pos_1000(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM1000t(pos_1000(1):pos_1000(11)),Volume_1000(pos_1000(1):pos_1000(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1000t(pos_1000(1):pos_1000(11)),RPM1000_Volt(pos_1000(1):pos_1000(11)))
xlabel('Time (Sec)')

% Figure for part 1b
f21=figure(21);
plot(Volume_1000(pos_1000(3):pos_1000(5)),RPM1000P(pos_1000(3):pos_1000(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c
f11=figure(11);
plot(Volume_1000(pos_1000(3):pos_1000(end)),RPM1000P(pos_1000(3):pos_1000(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_1000(pos_1000(i):pos_1000(i+2)),RPM1000P(pos_1000(i):pos_1000(i+2)))/2;
    P(j) = W(j)/(RPM1000t(pos_1000(i+2))-RPM1000t(pos_1000(i)));
    j=j+1;
end

Avg_W_1000 = mean(W);
Avg_P_1000 = mean(P);

MFR = (dm_1000/(60/RPM1000t(end)))/(length(pos_1000)/2);

%MFR = ((dm_1000/(60/RPM1000t(end)))/(length(pos_1000)/2));
MFR2_1000 = dm_1000/60;

MFR_Cyl_1000 = MFR/2; % Flow rate of one cylinder per cycle
KW_1000 = Avg_P_1000/1000; % Power in KW
Torque_1000 = Avg_W_1000/3.16; % Engine Torque
Brake_Power_1000 = 2*pi*(1000/60)*Torque_1000;  
Brake_Eff_1000 = Brake_Power_1000/(MFR2_1000*(44e6)); % Brake thermal eff
Conv_Eff_1000  = Brake_Power_1000/(Avg_P_1000*2); % Mechanical conversion eff

%% 1100 RPM

Power_1100 = 12*745.7; % Watts
dm_1100 = (14156-14097)/1000; % kilograms

RPM1100P = (RPM1100_Pres./vp_conv).*6894; % Pa
RPM1100t = zeros(1,length(RPM1100P));

for i = 1:length(RPM1100t)
    RPM1100t(i) = RPM1100t(i) + (i-1)*.0002;
end
RPM1100t = RPM1100t';
sw = 0;
j = 1;
thresh = 1;
n = length(RPM1100_Volt);

for i = 1:n
    if RPM1100_Volt(i) - thresh > 0 && sw == 0
        sw = 1;
        pos_1100(j) = i;
        j = j + 1;
    elseif RPM1100_Volt(i) - thresh < 0 && sw == 1
        sw = 0;
    end
end

theta_1100 = zeros(length(RPM1100_Volt)-5,1);
for j = 1:length(pos_1100)-1
    for i = pos_1100(j):pos_1100(j+1)
        theta_1100(i) = 2*pi*(1 - ((RPM1100t(pos_1100(j+1)) - RPM1100t(i))/(RPM1100t(pos_1100(j+1)) - RPM1100t(pos_1100(j)))));
    end
end

Volume_1100 = Vol_Clea.*(1+(.5.*(CR-1)).*(R+1-cos(theta_1100)-sqrt(R.^2-(sin(theta_1100)).^2)));

% Figure for Part 1a
f12=figure(12);
subplot(3,1,3)
hold on
yyaxis left
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100P(pos_1100(1):pos_1100(11)))
ylabel('Pressure (Pa)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))

subplot(3,1,1)
hold on
yyaxis left
plot(RPM1100t(pos_1100(1):pos_1100(11)),theta_1100(pos_1100(1):pos_1100(11)))
ylabel('Angle (Radians)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))

subplot(3,1,2)
hold on
yyaxis left
plot(RPM1100t(pos_1100(1):pos_1100(11)),Volume_1100(pos_1100(1):pos_1100(11)))
ylabel('Volume (m^3)')
yyaxis right
ylabel('Output Voltage (V)')
plot(RPM1100t(pos_1100(1):pos_1100(11)),RPM1100_Volt(pos_1100(1):pos_1100(11)))
xlabel('Time (Sec)')

% Figure for part 1b
f22=figure(22);
plot(Volume_1100(pos_1100(3):pos_1100(5)),RPM1100P(pos_1100(3):pos_1100(5)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')

% Figure for part 1c
f13=figure(13);
plot(Volume_1100(pos_1100(3):pos_1100(end)),RPM1100P(pos_1100(3):pos_1100(end)))
xlabel('Cylinder Volume (m^3)')
ylabel('Cylinder Pressure (Pa)')



% Part 2
j=1;
W = zeros(10,1);
P = zeros(10,1);
for i = 1:2:19
    W(j) = trapz(Volume_1100(pos_1100(i):pos_1100(i+2)),RPM1100P(pos_1100(i):pos_1100(i+2)))/2;
    P(j) = W(j)/(RPM1100t(pos_1100(i+2))-RPM1100t(pos_1100(i)));
    j=j+1;
end

Avg_W_1100 = mean(W);
Avg_P_1100 = mean(P);

MFR = (dm_1100/(60/RPM1100t(end)))/(length(pos_1100)/2);

%MFR = ((dm_1100/(60/RPM1100t(end)))/(length(pos_1100)/2));
MFR2_1100 = dm_1100/60;

MFR_Cyl_1100 = MFR/2; % Flow rate of one cylinder per cycle
KW_1100 = Avg_P_1100/1000; % Power in KW
Torque_1100 = Avg_W_1100/3.16; % Engine Torque
Brake_Power_1100 = 2*pi*(1100/60)*Torque_1100;  
Brake_Eff_1100 = Brake_Power_1100/(MFR2_600*(44e6)); % Brake thermal eff
Conv_Eff_1100  = Brake_Power_1100/(Avg_P_1100*2); % Mechanical conversion eff

%% Final Calculations and Tables


Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100];
Power = [Avg_P_600;Avg_P_700;Avg_P_800;Avg_P_900;Avg_P_1000;Avg_P_1100];
Std_Work = std(Work);
Std_Power = std(Power);

RPM = ["600";"700";"800";"900";"1000";"1100";"Standard Deviation"]; % rotations per minute
Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100;Std_Work];
Power = [Avg_P_600;Avg_P_700;Avg_P_800;Avg_P_900;Avg_P_1000;Avg_P_1100;Std_Power];

T1 = table(RPM,Work,Power);


RPM = ["600";"700";"800";"900";"1000";"1100"]; % rotations per minute
MFR = [MFR_Cyl_600;MFR_Cyl_700;MFR_Cyl_800;MFR_Cyl_900;MFR_Cyl_1000;MFR_Cyl_1100]; % Mass flow rate kg/s
Power = [KW_600;KW_700;KW_800;KW_900;KW_1000;KW_1100]; % power in KW
Torque = [Torque_600;Torque_700;Torque_800;Torque_900;Torque_1000;Torque_1100]; % N-m
Brake_Efficiency = [Brake_Eff_600;Brake_Eff_700;Brake_Eff_800;Brake_Eff_900;Brake_Eff_1000;Brake_Eff_1100];
Conversion_Efficieny = [Conv_Eff_600;Conv_Eff_700;Conv_Eff_800;Conv_Eff_900;Conv_Eff_1000;Conv_Eff_1100];

T2 = table(RPM,MFR,Power,Torque,Brake_Efficiency,Conversion_Efficieny);

%% Plotting End Results

Work = [Avg_W_600;Avg_W_700;Avg_W_800;Avg_W_900;Avg_W_1000;Avg_W_1100];
RPM = [600;700;800;900;1000;1100]; % rotations per minute
BrakeTorque = 2*pi.*Work;

Torque = [Torque_600,Torque_700,Torque_800,Torque_900,Torque_1000,Torque_1100];

for i = 1:length(Torque)
    BrakePower(i) = 2*pi.*(RPM(i)/60).*Torque(i);
end

f14=figure(14);
yyaxis left
plot(RPM,BrakeTorque,'-o')
ylabel('Brake Torque (J)')
hold on
yyaxis right
plot(RPM,BrakePower,'-s')
ylabel('Brake Power (J/s)')
xlabel('Rotations Per Minute')
text(650,11000,'Maximum Brake Torque = 2113 J')
text(650,10500,'Maximum Brake Power = 11,150 J/s')

f15=figure(15);
plot(RPM,Brake_Efficiency,'-o')
xlabel('Rotations Per Minute')
ylabel('Brake Efficiency ( )')

f16 = figure(16);
plot(RPM,MFR,'-o')
xlabel('Rotations Per Minute')
ylabel('Mass Flow Rate (kg/Cycle/Cylinder)')

MFR2 = [MFR2_600,MFR2_700,MFR2_800,MFR2_900,MFR2_1000,MFR2_1100];
f17 = figure(17);
plot(RPM,MFR2,'-o')
xlabel('Rotations Per Minute')
ylabel('Mass Flow Rate (kg/s)')


%% Saving Figures

saveas(f1, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot600.png','png');
saveas(f2, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle600.png','png');
saveas(f3, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle600.png','png');

saveas(f4, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot700.png','png');
saveas(f5, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle700.png','png');

saveas(f6, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot800.png','png');
saveas(f7, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle800.png','png');

saveas(f8, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot900.png','png');
saveas(f9, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle900.png','png');

saveas(f10, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot1000.png','png');
saveas(f11, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle1000.png','png');

saveas(f12, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\subplot1100.png','png');
saveas(f13, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\allcycle1100.png','png');

saveas(f14, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\braketorquepower.png','png');
saveas(f15, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\thermaleff.png','png');

saveas(f16, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\mfr.png','png');
saveas(f17, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\mfgkgs.png','png');

saveas(f18, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle700.png','png');
saveas(f19, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle800.png','png');
saveas(f20, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle900.png','png');
saveas(f21, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle1000.png','png');
saveas(f22, 'C:\Users\User\Desktop\Charlie\Classes\Junior Year\Spring 2019\J-Lab\Lab 5\Figures\onecycle1100.png','png');



##### SOURCE END #####
--></body></html>